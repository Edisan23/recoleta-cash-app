{
  "entities": {
    "User": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "User",
      "type": "object",
      "description": "Represents a user within the application.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the user."
        },
        "name": {
          "type": "string",
          "description": "The user's full name."
        },
        "email": {
          "type": "string",
          "description": "The user's email address.",
          "format": "email"
        },
        "phone": {
          "type": "string",
          "description": "The user's phone number."
        },
        "companyId": {
          "type": "string",
          "description": "Reference to Company. (Relationship: Company 1:N User) The ID of the company the user belongs to. Null if the user is an admin."
        },
        "role": {
          "type": "string",
          "description": "The user's role within the application (e.g., operator, admin)."
        },
        "createdAt": {
          "type": "string",
          "format": "date-time",
          "description": "The timestamp when the user account was created."
        },
        "paymentStatus": {
            "type": "string",
            "description": "The payment status of the user's account.",
            "enum": ["trial", "paid", "blocked"]
        }
      },
      "required": [
        "id",
        "name",
        "email",
        "role",
        "createdAt",
        "paymentStatus"
      ]
    },
    "Company": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Company",
      "type": "object",
      "description": "Represents a company using the application.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the company."
        },
        "name": {
          "type": "string",
          "description": "The name of the company."
        },
        "logoUrl": {
          "type": "string",
          "description": "URL of the company's logo.",
          "format": "uri"
        },
        "timezone": {
          "type": "string",
          "description": "The timezone the company operates in."
        },
        "country": {
          "type": "string",
          "description": "The country the company is located in."
        },
        "currency": {
          "type": "string",
          "description": "The currency used by the company."
        },
        "paymentRuleId": {
          "type": "string",
          "description": "Reference to PaymentRule. (Relationship: Company 1:1 PaymentRule) The ID of the payment rules associated with the company."
        }
      },
      "required": [
        "id",
        "name",
        "timezone",
        "country",
        "currency"
      ]
    },
    "PaymentRule": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "PaymentRule",
      "type": "object",
      "description": "Represents the payment rules for a company.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the payment rule."
        },
        "baseType": {
          "type": "string",
          "description": "The base type of payment (e.g., fixed, hourly, hourly+basic)."
        },
        "baseSalary": {
          "type": "number",
          "description": "The base salary, if applicable."
        },
        "hourlyRates": {
          "type": "object",
          "properties": {
              "diurna": { "type": "number" },
              "nocturna": { "type": "number" },
              "extraDiurna": { "type": "number" },
              "extraNocturna": { "type": "number" },
              "festivaDiurna": { "type": "number" },
              "festivaNocturna": { "type": "number" },
              "extraFestivaDiurna": { "type": "number" },
              "extraFestivaNocturna": { "type": "number" }
          }
        },
        "incentives": {
          "type": "array",
          "description": "Incentives based on certain conditions.",
          "items": {
            "type": "string"
          }
        },
        "socialContributions": {
          "type": "object",
          "description": "Social contribution percentages (salud, pension, etc.).",
           "properties": {
               "salud_pct": { "type": "number" },
               "pension_pct": { "type": "number" }
           }
        },
        "subsidies": {
          "type": "object",
          "description": "Subsidies such as transportation.",
          "properties": {
              "transporte": { "type": "number" }
          }
        }
      },
      "required": [
        "id",
        "baseType"
      ]
    },
    "Shift": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Shift",
      "type": "object",
      "description": "Represents a work shift for a user.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the shift."
        },
        "userId": {
          "type": "string",
          "description": "Reference to User. (Relationship: User 1:N Shift) The ID of the user who worked the shift."
        },
        "companyId": {
          "type": "string",
          "description": "Reference to Company. (Relationship: Company 1:N Shift) The ID of the company the shift belongs to."
        },
        "date": {
          "type": "string",
          "description": "The date of the shift.",
          "format": "date-time"
        },
        "startTime": {
          "type": "string",
          "description": "The start time of the shift.",
          "format": "date-time"
        },
        "endTime": {
          "type": "string",
          "description": "The end time of the shift.",
          "format": "date-time"
        },
        "itemId": {
          "type": "string",
          "description": "Reference to Item. (Relationship: Item 1:N Shift) The ID of the item associated with the shift (e.g., TT, bulto, machine)."
        },
        "ttNumber": {
          "type": "string",
          "description": "The TT number, if applicable."
        },
        "createdAt": {
          "type": "string",
          "description": "The timestamp when the shift was created.",
          "format": "date-time"
        },
        "updatedAt": {
          "type": "string",
          "description": "The timestamp when the shift was last updated.",
          "format": "date-time"
        },
        "manualFlag": {
          "type": "boolean",
          "description": "Indicates if the shift was manually entered."
        },
        "hoursBreakdown": {
          "type": "object",
          "description": "Breakdown of hours by type (diurna, nocturna, extra, festiva, etc.).",
           "properties": {
              "diurna": { "type": "number" },
              "nocturna": { "type": "number" },
              "extraDiurna": { "type": "number" },
              "extraNocturna": { "type": "number" },
              "festivaDiurna": { "type": "number" },
              "festivaNocturna": { "type": "number" }
          }
        },
        "grossValue": {
          "type": "number",
          "description": "The gross value of the shift."
        }
      },
      "required": [
        "id",
        "userId",
        "companyId",
        "date",
        "startTime",
        "endTime"
      ]
    },
    "Payroll": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Payroll",
      "type": "object",
      "description": "Represents a payroll for a user.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the payroll."
        },
        "companyId": {
          "type": "string",
          "description": "Reference to Company. (Relationship: Company 1:N Payroll) The ID of the company the payroll belongs to."
        },
        "userId": {
          "type": "string",
          "description": "Reference to User. (Relationship: User 1:N Payroll) The ID of the user the payroll is for."
        },
        "periodStart": {
          "type": "string",
          "description": "The start date of the payroll period.",
          "format": "date-time"
        },
        "periodEnd": {
          "type": "string",
          "description": "The end date of the payroll period.",
          "format": "date-time"
        },
        "totalHours": {
          "type": "number",
          "description": "The total hours worked during the payroll period."
        },
        "grossPay": {
          "type": "number",
          "description": "The gross pay for the payroll period."
        },
        "incentives": {
          "type": "number",
          "description": "The incentives earned during the payroll period."
        },
        "subsidies": {
          "type": "number",
          "description": "The subsidies received during the payroll period."
        },
        "deductions": {
          "type": "number",
          "description": "The deductions taken during the payroll period."
        },
        "netPay": {
          "type": "number",
          "description": "The net pay for the payroll period."
        },
        "status": {
          "type": "string",
          "description": "The status of the payroll (e.g., draft, approved, paid)."
        }
      },
      "required": [
        "id",
        "companyId",
        "userId",
        "periodStart",
        "periodEnd",
        "totalHours",
        "grossPay",
        "netPay",
        "status"
      ]
    },
    "Setting": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Setting",
      "type": "object",
      "description": "Represents global settings for the application.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the setting."
        },
        "globalDefaults": {
          "type": "string",
          "description": "Global default settings."
        },
        "holidayCalendar": {
          "type": "string",
          "description": "Reference to HolidayCalendar. (Relationship: Setting 1:1 HolidayCalendar) Reference to the holiday calendar."
        },
        "currencyFormat": {
          "type": "string",
          "description": "The format for displaying currency."
        }
      },
      "required": [
        "id"
      ]
    },
    "Item": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Item",
      "type": "object",
      "description": "Represents an item of work (e.g., TT, bulto, machine).",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the item."
        },
        "companyId": {
          "type": "string",
          "description": "Reference to Company. (Relationship: Company 1:N Item). The id of the company this item belongs to."
        },
        "name": {
          "type": "string",
          "description": "The name of the item."
        },
        "type": {
          "type": "string",
          "description": "The type of item (e.g., TT, bulto, machine)."
        },
        "unit": {
          "type": "string",
          "description": "The unit of measurement for the item."
        },
        "description": {
          "type": "string",
          "description": "A description of the item."
        }
      },
      "required": [
        "id",
        "name",
        "type",
        "unit"
      ]
    },
    "HolidayCalendar": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "HolidayCalendar",
      "type": "object",
      "description": "Represents a calendar of holidays.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the holiday calendar."
        },
        "name": {
          "type": "string",
          "description": "The name of the holiday calendar."
        },
        "holidays": {
          "type": "array",
          "description": "An array of holiday dates.",
          "items": {
            "type": "string",
            "format": "date"
          }
        }
      },
      "required": [
        "id",
        "name",
        "holidays"
      ]
    }
  },
  "auth": {
    "providers": [
      "password",
      "anonymous",
      "google.com"
    ]
  },
  "firestore": {
    "structure": [
      {
        "path": "/companies/{companyId}",
        "definition": {
          "entityName": "Company",
          "schema": {
            "$ref": "#/backend/entities/Company"
          },
          "description": "Stores company information. Includes denormalized 'companyId' on child collections for authorization independence.",
          "params": [
            {
              "name": "companyId",
              "description": "The unique identifier for the company."
            }
          ]
        }
      },
      {
        "path": "/companies/{companyId}/items/{itemId}",
        "definition": {
          "entityName": "Item",
          "schema": {
            "$ref": "#/backend/entities/Item"
          },
          "description": "Stores items specific to a company.",
          "params": [
            {
              "name": "companyId",
              "description": "The unique identifier for the company."
            },
            {
              "name": "itemId",
              "description": "The unique identifier for the item."
            }
          ]
        }
      },
      {
        "path": "/payment_rules/{paymentRuleId}",
        "definition": {
          "entityName": "PaymentRule",
          "schema": {
            "$ref": "#/backend/entities/PaymentRule"
          },
          "description": "Stores payment rules for companies.",
          "params": [
            {
              "name": "paymentRuleId",
              "description": "The unique identifier for the payment rule."
            }
          ]
        }
      },
      {
        "path": "/users/{userId}",
        "definition": {
          "entityName": "User",
          "schema": {
            "$ref": "#/backend/entities/User"
          },
          "description": "Stores user information. Includes 'companyId' and 'role' for authorization.",
          "params": [
            {
              "name": "userId",
              "description": "The unique identifier for the user."
            }
          ]
        }
      },
      {
        "path": "/users/{userId}/shifts/{shiftId}",
        "definition": {
          "entityName": "Shift",
          "schema": {
            "$ref": "#/backend/entities/Shift"
          },
          "description": "Stores shift information for a user. Includes denormalized 'companyId' and 'userId' for authorization independence.",
          "params": [
            {
              "name": "userId",
              "description": "The unique identifier for the user."
            },
            {
              "name": "shiftId",
              "description": "The unique identifier for the shift."
            }
          ]
        }
      },
      {
        "path": "/users/{userId}/payrolls/{payrollId}",
        "definition": {
          "entityName": "Payroll",
          "schema": {
            "$ref": "#/backend/entities/Payroll"
          },
          "description": "Stores payroll information for a user. Includes denormalized 'companyId' and 'userId' for authorization independence.",
          "params": [
            {
              "name": "userId",
              "description": "The unique identifier for the user."
            },
            {
              "name": "payrollId",
              "description": "The unique identifier for the payroll."
            }
          ]
        }
      },
      {
        "path": "/settings/{settingId}",
        "definition": {
          "entityName": "Setting",
          "schema": {
            "$ref": "#/backend/entities/Setting"
          },
          "description": "Stores global settings for the application.",
          "params": [
            {
              "name": "settingId",
              "description": "The unique identifier for the setting."
            }
          ]
        }
      },
      {
        "path": "/holiday_calendars/{holidayCalendarId}",
        "definition": {
          "entityName": "HolidayCalendar",
          "schema": {
            "$ref": "#/backend/entities/HolidayCalendar"
          },
          "description": "Stores global holiday calendar",
          "params": [
            {
              "name": "holidayCalendarId",
              "description": "The unique identifier for the holiday calendar."
            }
          ]
        }
      }
    ],
    "reasoning": "This Firestore structure is designed to support a multi-company time tracking and payroll application. It prioritizes authorization independence and QAPs through denormalization and structural segregation.\n\n*   **Authorization Independence:** The `shifts` collection stores `companyId` and `userId`, denormalizing this data to avoid `get()` calls in security rules. User roles (operator/admin) are stored directly within the `users` document.\n\n*   **Structural Segregation:** Each entity type (companies, users, shifts, etc.) is stored in its own top-level collection, ensuring a homogeneous security posture for each collection. User specific data (shifts, payrolls) are created in a heirarchy.\n\n*   **QAPs:** List operations are secured by the path structure (e.g., listing shifts for a specific user under `/users/{userId}/shifts`). Admin access to company-related data is controlled by checking the user's role and the relevant `companyId`.\n\n\nThis structure supports the core application features, including user authentication, company management, shift recording, payroll calculation, and reporting. The design facilitates clear and robust security rules, making the application more secure and maintainable."
  }
}
